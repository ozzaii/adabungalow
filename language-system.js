// ═══════════════════════════════════════════════════════════════════════════════
// ENHANCED LANGUAGE SYSTEM - ADA BUNGALOW UZUNGÖL
// Reliable Multi-Language Support (TR/EN/AR)
// ═══════════════════════════════════════════════════════════════════════════════

const siteTranslations = {
  tr: {
    // Navigation
    nav: {
      home: 'Ana Sayfa',
      experience: 'Deneyim',
      suites: 'Villalar',
      amenities: 'Olanaklar',
      gallery: 'Galeri',
      contact: 'İletişim',
      reserve: 'Rezervasyon'
    },
    // Hero Section
    hero: {
      badge: "Uzungöl'ün En Özel Adresi",
      title: 'ADA BUNGALOW',
      subtitle: 'UZUNGÖL',
      description: 'Doğanın kalbinde lüks ve huzurun buluştuğu nokta',
      cta1: 'Keşfet',
      cta2: 'WhatsApp İletişim',
      scroll: 'Kaydır',
      meta: {
        elevation: 'Rakım',
        villas: 'Özel Villa',
        rating: 'Lüks Kategori'
      }
    },
    // Experience Section
    experience: {
      label: 'Deneyim',
      title1: 'Bulutların',
      title2: 'Üzerinde Bir Cennet',
      lead: 'Deniz seviyesinden 1,090 metre yükseklikte, Uzungöl\'ün eşsiz doğası içinde Ada Bungalow, Karadeniz\'in mistik atmosferinde lüks konaklama deneyimi sunuyor.',
      text: 'Özenle tasarlanmış her villa, modern konfor ve doğal güzelliğin mükemmel uyumunu sunuyor. Uzungöl\'ün berrak suları üzerinde dans eden sabah sisine uyanın, yıldızların altında huzur içinde dinlenin.',
      features: {
        luxury: {
          title: 'Özel Tasarım',
          desc: 'Her villada panoramik manzara'
        },
        service: {
          title: 'Kişiye Özel Hizmet',
          desc: '7/24 müşteri hizmetleri'
        },
        nature: {
          title: 'Doğayla İç İçe',
          desc: 'Huzur dolu anlar'
        }
      }
    },
    // Suites Section
    suites: {
      label: 'Konaklama',
      title1: 'Özel',
      title2: 'Villalarımız',
      types: {
        vip: {
          name: 'Havuzlu VIP Villa',
          desc: 'Özel havuzlu VIP villa, geniş yaşam alanı, tam donanımlı mutfak ve Uzungöl\'e hakim muhteşem manzara.',
          features: ['Özel Havuz', 'VIP Konsept', 'Panoramik Manzara']
        },
        waterfall: {
          name: 'Şelaleli Villa',
          desc: 'Doğal şelale manzaralı özel villa, huzurlu ortam, jakuzi ve şömineli geniş salon.',
          features: ['Şelale Manzarası', 'Jakuzi', 'Şömine']
        },
        luxury: {
          name: 'Luxury 3+1 Villa',
          desc: 'Lüks konseptte 3+1 villa, geniş aile için ideal, modern donanım ve Uzungöl\'ün eşsiz doğası.',
          features: ['3+1 Konsept', 'Aile Süiti', 'Modern Donanım']
        }
      },
      priceText: 'Fiyat için',
      callText: 'Arayınız',
      whatsappBtn: 'WhatsApp'
    },
    // Amenities
    amenities: {
      label: 'Olanaklar',
      title1: 'Konfor ve',
      title2: 'Ayrıcalıklar',
      list: {
        restaurant: {
          title: 'Restoran',
          desc: 'Yöresel ve dünya mutfağından özel lezzetler, organik ve taze malzemeler.'
        },
        pool: {
          title: 'Özel Havuz',
          desc: 'VIP villalarda özel havuz keyfi, manzara eşliğinde yüzme imkanı.'
        },
        activities: {
          title: 'Aktiviteler',
          desc: 'Doğa yürüyüşleri, tekne turları, yayla gezileri ve kültürel aktiviteler.'
        },
        service: {
          title: '7/24 Hizmet',
          desc: 'Misafir memnuniyeti odaklı, kesintisiz hizmet anlayışı.'
        }
      }
    },
    // Gallery
    gallery: {
      label: 'Galeri',
      title1: 'Görsel',
      title2: 'Yolculuk',
      viewAll: 'Tümünü Gör'
    },
    // Contact
    contact: {
      label: 'İletişim',
      title1: 'Rezervasyon',
      title2: 've İletişim',
      desc: 'Hayalinizdeki tatil için hemen bizimle iletişime geçin. Uzman ekibimiz size özel tatil planlaması için hazır.',
      info: {
        phone: 'Telefon',
        whatsapp: 'WhatsApp',
        email: 'E-posta',
        address: 'Adres'
      },
      form: {
        name: 'Ad Soyad',
        email: 'E-posta',
        phone: 'Telefon',
        checkin: 'Giriş Tarihi',
        checkout: 'Çıkış Tarihi',
        villa: 'Villa Seçimi',
        message: 'Mesajınız',
        send: 'WhatsApp ile Gönder'
      }
    },
    // Footer
    footer: {
      tagline: 'Uzungöl\'de Lüks Konaklama',
      quickLinks: 'Hızlı Linkler',
      followUs: 'Bizi Takip Edin',
      rights: '© 2024 Ada Bungalow Uzungöl. Tüm hakları saklıdır.',
      privacy: 'Gizlilik Politikası',
      terms: 'Kullanım Koşulları'
    },
    // Common
    common: {
      loading: 'Yükleniyor...',
      error: 'Bir hata oluştu',
      success: 'Başarılı',
      close: 'Kapat',
      more: 'Daha Fazla',
      less: 'Daha Az'
    }
  },
  
  en: {
    // Navigation
    nav: {
      home: 'Home',
      experience: 'Experience',
      suites: 'Villas',
      amenities: 'Amenities',
      gallery: 'Gallery',
      contact: 'Contact',
      reserve: 'Reserve Now'
    },
    // Hero Section
    hero: {
      badge: "Uzungöl's Most Exclusive Address",
      title: 'ADA BUNGALOW',
      subtitle: 'UZUNGÖL',
      description: 'Where luxury meets nature in perfect harmony',
      cta1: 'Discover',
      cta2: 'WhatsApp Contact',
      scroll: 'Scroll',
      meta: {
        elevation: 'Elevation',
        villas: 'Private Villas',
        rating: 'Luxury Category'
      }
    },
    // Experience Section
    experience: {
      label: 'Experience',
      title1: 'A Paradise',
      title2: 'Above The Clouds',
      lead: 'At 1,090 meters above sea level, Ada Bungalow offers a luxury accommodation experience in the mystical atmosphere of the Black Sea, nestled in Uzungöl\'s unique nature.',
      text: 'Each carefully designed villa offers the perfect harmony of modern comfort and natural beauty. Wake up to the morning mist dancing over Uzungöl\'s clear waters, rest in peace under the stars.',
      features: {
        luxury: {
          title: 'Exclusive Design',
          desc: 'Panoramic views from every villa'
        },
        service: {
          title: 'Personalized Service',
          desc: '24/7 customer service'
        },
        nature: {
          title: 'One with Nature',
          desc: 'Peaceful moments'
        }
      }
    },
    // Suites Section
    suites: {
      label: 'Accommodation',
      title1: 'Our Exclusive',
      title2: 'Villas',
      types: {
        vip: {
          name: 'VIP Villa with Pool',
          desc: 'VIP villa with private pool, spacious living area, fully equipped kitchen and stunning views of Uzungöl.',
          features: ['Private Pool', 'VIP Concept', 'Panoramic View']
        },
        waterfall: {
          name: 'Waterfall Villa',
          desc: 'Private villa with natural waterfall view, peaceful environment, jacuzzi and spacious living room with fireplace.',
          features: ['Waterfall View', 'Jacuzzi', 'Fireplace']
        },
        luxury: {
          name: 'Luxury 3+1 Villa',
          desc: 'Luxury concept 3+1 villa, ideal for large families, modern equipment and Uzungöl\'s unique nature.',
          features: ['3+1 Concept', 'Family Suite', 'Modern Equipment']
        }
      },
      priceText: 'For Price',
      callText: 'Contact Us',
      whatsappBtn: 'WhatsApp'
    },
    // Amenities
    amenities: {
      label: 'Amenities',
      title1: 'Comfort and',
      title2: 'Privileges',
      list: {
        restaurant: {
          title: 'Restaurant',
          desc: 'Special flavors from local and world cuisine, organic and fresh ingredients.'
        },
        pool: {
          title: 'Private Pool',
          desc: 'Private pool enjoyment in VIP villas, swimming with scenic views.'
        },
        activities: {
          title: 'Activities',
          desc: 'Nature walks, boat tours, plateau trips and cultural activities.'
        },
        service: {
          title: '24/7 Service',
          desc: 'Guest satisfaction focused, uninterrupted service approach.'
        }
      }
    },
    // Gallery
    gallery: {
      label: 'Gallery',
      title1: 'Visual',
      title2: 'Journey',
      viewAll: 'View All'
    },
    // Contact
    contact: {
      label: 'Contact',
      title1: 'Reservation',
      title2: 'and Contact',
      desc: 'Contact us immediately for your dream vacation. Our expert team is ready for your personalized vacation planning.',
      info: {
        phone: 'Phone',
        whatsapp: 'WhatsApp',
        email: 'Email',
        address: 'Address'
      },
      form: {
        name: 'Full Name',
        email: 'Email',
        phone: 'Phone',
        checkin: 'Check-in Date',
        checkout: 'Check-out Date',
        villa: 'Villa Selection',
        message: 'Your Message',
        send: 'Send via WhatsApp'
      }
    },
    // Footer
    footer: {
      tagline: 'Luxury Accommodation in Uzungöl',
      quickLinks: 'Quick Links',
      followUs: 'Follow Us',
      rights: '© 2024 Ada Bungalow Uzungöl. All rights reserved.',
      privacy: 'Privacy Policy',
      terms: 'Terms of Service'
    },
    // Common
    common: {
      loading: 'Loading...',
      error: 'An error occurred',
      success: 'Successful',
      close: 'Close',
      more: 'More',
      less: 'Less'
    }
  },
  
  ar: {
    // Navigation
    nav: {
      home: 'الرئيسية',
      experience: 'التجربة',
      suites: 'الفيلات',
      amenities: 'المرافق',
      gallery: 'المعرض',
      contact: 'اتصل بنا',
      reserve: 'احجز الآن'
    },
    // Hero Section
    hero: {
      badge: 'العنوان الأكثر تميزًا في أوزنجول',
      title: 'آدا بنغالو',
      subtitle: 'أوزنجول',
      description: 'حيث تلتقي الفخامة بالطبيعة في تناغم مثالي',
      cta1: 'اكتشف',
      cta2: 'تواصل واتساب',
      scroll: 'تمرير',
      meta: {
        elevation: 'الارتفاع',
        villas: 'فيلات خاصة',
        rating: 'فئة فاخرة'
      }
    },
    // Experience Section
    experience: {
      label: 'التجربة',
      title1: 'جنة',
      title2: 'فوق السحاب',
      lead: 'على ارتفاع 1090 مترًا فوق مستوى سطح البحر، يقدم آدا بنغالو تجربة إقامة فاخرة في الأجواء الصوفية للبحر الأسود، في قلب طبيعة أوزنجول الفريدة.',
      text: 'كل فيلا مصممة بعناية توفر التناغم المثالي بين الراحة الحديثة والجمال الطبيعي. استيقظ على الضباب الصباحي الراقص فوق مياه أوزنجول الصافية، واسترح بسلام تحت النجوم.',
      features: {
        luxury: {
          title: 'تصميم حصري',
          desc: 'إطلالات بانورامية من كل فيلا'
        },
        service: {
          title: 'خدمة شخصية',
          desc: 'خدمة عملاء على مدار الساعة'
        },
        nature: {
          title: 'واحد مع الطبيعة',
          desc: 'لحظات هادئة'
        }
      }
    },
    // Suites Section
    suites: {
      label: 'الإقامة',
      title1: 'فيلاتنا',
      title2: 'الحصرية',
      types: {
        vip: {
          name: 'فيلا VIP مع مسبح',
          desc: 'فيلا VIP مع مسبح خاص، منطقة معيشة واسعة، مطبخ مجهز بالكامل وإطلالات خلابة على أوزنجول.',
          features: ['مسبح خاص', 'مفهوم VIP', 'إطلالة بانورامية']
        },
        waterfall: {
          name: 'فيلا الشلال',
          desc: 'فيلا خاصة مع إطلالة على الشلال الطبيعي، بيئة هادئة، جاكوزي وغرفة معيشة واسعة مع موقد.',
          features: ['إطلالة على الشلال', 'جاكوزي', 'موقد']
        },
        luxury: {
          name: 'فيلا فاخرة 3+1',
          desc: 'فيلا بمفهوم فاخر 3+1، مثالية للعائلات الكبيرة، معدات حديثة وطبيعة أوزنجول الفريدة.',
          features: ['مفهوم 3+1', 'جناح عائلي', 'معدات حديثة']
        }
      },
      priceText: 'للسعر',
      callText: 'اتصل بنا',
      whatsappBtn: 'واتساب'
    },
    // Amenities
    amenities: {
      label: 'المرافق',
      title1: 'الراحة',
      title2: 'والامتيازات',
      list: {
        restaurant: {
          title: 'مطعم',
          desc: 'نكهات خاصة من المطبخ المحلي والعالمي، مكونات عضوية وطازجة.'
        },
        pool: {
          title: 'مسبح خاص',
          desc: 'متعة المسبح الخاص في الفيلات الـ VIP، السباحة مع المناظر الخلابة.'
        },
        activities: {
          title: 'الأنشطة',
          desc: 'المشي في الطبيعة، جولات القوارب، رحلات الهضبة والأنشطة الثقافية.'
        },
        service: {
          title: 'خدمة 24/7',
          desc: 'نهج خدمة غير منقطع يركز على رضا الضيوف.'
        }
      }
    },
    // Gallery
    gallery: {
      label: 'المعرض',
      title1: 'رحلة',
      title2: 'بصرية',
      viewAll: 'عرض الكل'
    },
    // Contact
    contact: {
      label: 'اتصل بنا',
      title1: 'الحجز',
      title2: 'والاتصال',
      desc: 'اتصل بنا فورًا لعطلة أحلامك. فريق الخبراء لدينا جاهز لتخطيط عطلتك الشخصية.',
      info: {
        phone: 'الهاتف',
        whatsapp: 'واتساب',
        email: 'البريد الإلكتروني',
        address: 'العنوان'
      },
      form: {
        name: 'الاسم الكامل',
        email: 'البريد الإلكتروني',
        phone: 'الهاتف',
        checkin: 'تاريخ الوصول',
        checkout: 'تاريخ المغادرة',
        villa: 'اختيار الفيلا',
        message: 'رسالتك',
        send: 'إرسال عبر واتساب'
      }
    },
    // Footer
    footer: {
      tagline: 'إقامة فاخرة في أوزنجول',
      quickLinks: 'روابط سريعة',
      followUs: 'تابعنا',
      rights: '© 2024 آدا بنغالو أوزنجول. جميع الحقوق محفوظة.',
      privacy: 'سياسة الخصوصية',
      terms: 'شروط الخدمة'
    },
    // Common
    common: {
      loading: 'جاري التحميل...',
      error: 'حدث خطأ',
      success: 'نجح',
      close: 'إغلاق',
      more: 'المزيد',
      less: 'أقل'
    }
  }
};

// Enhanced Language Manager Class
class EnhancedLanguageManager {
  constructor() {
    this.currentLang = this.detectLanguage();
    this.init();
  }

  detectLanguage() {
    // 1. Check URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    if (urlLang && siteTranslations[urlLang]) {
      this.saveLanguage(urlLang);
      return urlLang;
    }

    // 2. Check saved preference
    const saved = localStorage.getItem('adaBungalowLang');
    if (saved && siteTranslations[saved]) {
      return saved;
    }

    // 3. Auto-detect from browser
    const browserLang = navigator.language || navigator.userLanguage;
    const langCode = browserLang.toLowerCase();
    
    // More comprehensive detection
    if (langCode.includes('tr')) return 'tr';
    if (langCode.includes('ar') || langCode.includes('sa')) return 'ar';
    if (langCode.includes('en')) return 'en';
    
    // Default to Turkish for Turkey region
    if (Intl.DateTimeFormat().resolvedOptions().timeZone.includes('Istanbul')) {
      return 'tr';
    }
    
    return 'tr'; // Default to Turkish
  }

  saveLanguage(lang) {
    localStorage.setItem('adaBungalowLang', lang);
  }

  init() {
    this.createLanguageSelector();
    this.applyLanguage();
    this.setupEventListeners();
  }

  createLanguageSelector() {
    // Add language selector to navigation
    const nav = document.querySelector('.nav-actions');
    if (nav && !document.getElementById('languageSelector')) {
      const selector = document.createElement('div');
      selector.id = 'languageSelector';
      selector.className = 'language-selector';
      selector.innerHTML = `
        <button class="lang-current" aria-label="Change Language">
          <span class="lang-flag">${this.getFlagEmoji(this.currentLang)}</span>
          <span class="lang-code">${this.currentLang.toUpperCase()}</span>
        </button>
        <div class="lang-dropdown">
          <button data-lang="tr" class="${this.currentLang === 'tr' ? 'active' : ''}">
            <span class="lang-flag">🇹🇷</span> Türkçe
          </button>
          <button data-lang="en" class="${this.currentLang === 'en' ? 'active' : ''}">
            <span class="lang-flag">🇬🇧</span> English
          </button>
          <button data-lang="ar" class="${this.currentLang === 'ar' ? 'active' : ''}">
            <span class="lang-flag">🇸🇦</span> العربية
          </button>
        </div>
      `;
      nav.appendChild(selector);
    }
  }

  getFlagEmoji(lang) {
    const flags = {
      tr: '🇹🇷',
      en: '🇬🇧',
      ar: '🇸🇦'
    };
    return flags[lang] || '🌐';
  }

  setupEventListeners() {
    // Language selector click
    const selector = document.getElementById('languageSelector');
    if (selector) {
      const current = selector.querySelector('.lang-current');
      const dropdown = selector.querySelector('.lang-dropdown');
      
      current.addEventListener('click', () => {
        dropdown.classList.toggle('show');
      });
      
      // Language option clicks
      dropdown.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.dataset.lang;
          this.changeLanguage(lang);
          dropdown.classList.remove('show');
        });
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!selector.contains(e.target)) {
          dropdown.classList.remove('show');
        }
      });
    }
  }

  changeLanguage(lang) {
    if (siteTranslations[lang]) {
      this.currentLang = lang;
      this.saveLanguage(lang);
      this.applyLanguage();
      this.updateSelector();
    }
  }

  updateSelector() {
    const selector = document.getElementById('languageSelector');
    if (selector) {
      const current = selector.querySelector('.lang-current');
      current.innerHTML = `
        <span class="lang-flag">${this.getFlagEmoji(this.currentLang)}</span>
        <span class="lang-code">${this.currentLang.toUpperCase()}</span>
      `;
      
      // Update active state
      selector.querySelectorAll('.lang-dropdown button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === this.currentLang);
      });
    }
  }

  applyLanguage() {
    const t = siteTranslations[this.currentLang];
    if (!t) return;
    
    // Update HTML attributes
    document.documentElement.lang = this.currentLang;
    document.documentElement.dir = this.currentLang === 'ar' ? 'rtl' : 'ltr';
    
    // Apply all translations
    this.updateAllElements(t);
    
    // Update WhatsApp messages
    this.updateWhatsAppMessages();
  }

  updateAllElements(t) {
    // Use data attributes for reliable element selection
    document.querySelectorAll('[data-translate]').forEach(el => {
      const key = el.dataset.translate;
      const translation = this.getNestedProperty(t, key);
      if (translation) {
        el.textContent = translation;
      }
    });
    
    // Update placeholders
    document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
      const key = el.dataset.translatePlaceholder;
      const translation = this.getNestedProperty(t, key);
      if (translation) {
        el.placeholder = translation;
      }
    });
    
    // Update aria-labels
    document.querySelectorAll('[data-translate-aria]').forEach(el => {
      const key = el.dataset.translateAria;
      const translation = this.getNestedProperty(t, key);
      if (translation) {
        el.setAttribute('aria-label', translation);
      }
    });
  }

  getNestedProperty(obj, key) {
    return key.split('.').reduce((o, k) => o?.[k], obj);
  }

  updateWhatsAppMessages() {
    // Update WhatsApp links with correct language
    const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
    const messages = {
      tr: 'Merhaba, Ada Bungalow rezervasyon bilgisi almak istiyorum.',
      en: 'Hello, I would like to get reservation information for Ada Bungalow.',
      ar: 'مرحبا، أود الحصول على معلومات الحجز لآدا بنغالو.'
    };
    
    whatsappLinks.forEach(link => {
      const url = new URL(link.href);
      url.searchParams.set('text', messages[this.currentLang]);
      link.href = url.toString();
    });
  }
}

// Initialize on DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    window.languageManager = new EnhancedLanguageManager();
  });
} else {
  window.languageManager = new EnhancedLanguageManager();
}